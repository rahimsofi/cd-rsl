<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fusion JSON Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    background: #0e0e0e;
    color: #fcf6ff;
    font-family: 'Inter', sans-serif;
    padding: 40px;
  }

  input, select {
    background: #1a1a1a;
    border: 1px solid #d4af37;
    color: #fcf6ff;
    padding: 6px 10px;
    border-radius: 6px;
    margin-right: 8px;
  }

  input[type="date"] {
    color-scheme: dark;
  }

  button {
    background: #d4af37;
    color: #0e0e0e;
    border: none;
    border-radius: 6px;
    padding: 6px 14px;
    cursor: pointer;
    margin-right: 10px;
  }

  button:hover { background: #f0d372; }

  textarea {
    width: 100%;
    height: 280px;
    background: #1a1a1a;
    color: #00c9ff;
    border: 1px solid #d4af37;
    border-radius: 6px;
    padding: 10px;
  }

  .row {
    margin-bottom: 14px;
  }

  h1, h3 {
    color: #f52584;
  }
</style>
</head>
<body>

<h1>Fusion JSON Builder</h1>

<!-- === TITLE === -->
<div class="row">
  <label>Fusion Title: </label>
  <input type="text" id="fusionTitle" placeholder="Ex: KRO'KHAD THE THROATRIPPER - FRAGMENT FUSION â€¢ 28/07/2025 - 11/08/2025" style="width:640px;">
</div>

<!-- === NAME + TYPE === -->
<div class="row">
  <label>Name: </label>
  <input type="text" id="nameInput" list="eventNames" placeholder="Select or type event name...">
  <datalist id="eventNames"></datalist>

  <label>Type: </label>
  <input type="text" id="typeInput" placeholder="Auto-filled" style="width:140px;" readonly>
</div>

<!-- === DATES === -->
<div class="row">
  <label>Start Date: </label>
  <input type="date" id="startDate">

  <label>End Date: </label>
  <input type="date" id="endDate">
</div>

<!-- === REWARD + POINTS === -->
<div class="row">
  <label>Reward: </label>
  <input type="text" id="rewardInput" placeholder="Ex: Fragments, Cithrel..." style="width:300px;">

  <label>Points: </label>
  <input type="text" id="pointsInput" placeholder="Ex: 5 or 10,10" style="width:140px;">
</div>

<!-- === ACTION BUTTONS === -->
<div class="row">
  <button onclick="addEvent()">Add Event</button>
  <button onclick="exportJSON()">Export JSON</button>
  <button onclick="copyJSON()">Copy JSON</button>
  <button onclick="clearAll()">Clear All</button>
</div>

<h3>Generated JSON:</h3>
<textarea id="output" readonly></textarea>

<script>
  let events = [];
  let eventList = [];

  // === Load event list from events.json ===
  async function loadEventList() {
    try {
      const res = await fetch("events.json");
      eventList = await res.json();
      const datalist = document.getElementById("eventNames");

      eventList.events.forEach(e => {
        const option = document.createElement("option");
        option.value = e.name;
        datalist.appendChild(option);
      });
    } catch (err) {
      console.error("âŒ Could not load events.json:", err);
    }
  }

  // === Auto-fill type when selecting an event name ===
  document.getElementById("nameInput").addEventListener("input", () => {
    const name = document.getElementById("nameInput").value.trim();
    const ev = eventList.events.find(e => e.name.toLowerCase() === name.toLowerCase());
    document.getElementById("typeInput").value = ev ? ev.type : "";
  });

  // === Add an event ===
  function addEvent() {
    const name = document.getElementById("nameInput").value.trim();
    const type = document.getElementById("typeInput").value.trim();
    const start = document.getElementById("startDate").value.trim();
    const end = document.getElementById("endDate").value.trim();
    const reward = document.getElementById("rewardInput").value.trim();
    const pointsRaw = document.getElementById("pointsInput").value.trim();

    if (!name) return alert("âŒ Please enter or select an event name.");
    if (!start || !end) return alert("âŒ Please fill in both start and end dates.");

    const points = pointsRaw
      ? pointsRaw.split(',').map(p => parseInt(p.trim())).filter(p => !isNaN(p))
      : [];

    events.push({
      name,
      ...(type ? { type } : {}),
      start_date: start,
      end_date: end,
      ...(reward ? { reward } : {}),
      ...(points.length ? { points } : {})
    });

    updateOutput();

    // ðŸ” Reset only name & type, keep dates/reward/points
    document.getElementById("nameInput").value = "";
    document.getElementById("typeInput").value = "";
  }

  // === Update JSON output ===
  function updateOutput() {
    const title = document.getElementById("fusionTitle").value.trim() || "UNTITLED FUSION";
    const fullJSON = {
      title,
      events
    };
    document.getElementById("output").value = JSON.stringify(fullJSON, null, 2);
  }

  // === Export JSON file ===
  function exportJSON() {
    if (!events.length) return alert("No events added yet.");
    const jsonText = document.getElementById("output").value;
    const blob = new Blob([jsonText], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    const title = document.getElementById("fusionTitle").value.trim() || "fusion";
    a.download = title.replace(/\s+/g, '-') + '.json';
    a.click();
  }

  // === Copy JSON ===
  function copyJSON() {
    const text = document.getElementById("output").value;
    if (!text.trim()) return alert("Nothing to copy yet.");
    navigator.clipboard.writeText(text).then(() => {
      alert("âœ… JSON copied to clipboard!");
    });
  }

  // === Clear all ===
  function clearAll() {
    if (confirm("Clear all events?")) {
      events = [];
      document.getElementById("output").value = "";
    }
  }

  // === Load list on startup ===
  loadEventList();
</script>


</body>
</html>
