<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HNK5S7EBCJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-HNK5S7EBCJ');
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <meta charset="UTF-8">
  <script src="/config/site-config.js"></script>
  <script>document.title =  "Champions Index | " + window.siteConfig.title;</script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../style/style.css">
  <style>

  body {
    font-family: 'Inter', sans-serif;
    background-color: #0e0e0e;
    color: #fcf6ff;
    margin: 0;
    padding: 0;
  }

  .container {
    width: 95%;
    max-width: 1400px;
    margin: 20px auto;
  }

  /* === Recherche === */
  .search-bar {
    text-align: center;
    margin-bottom: 15px;
  }

  #searchInput {
    width: 60%;
    padding: 12px 16px;
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid #d4af37;
    background: #1a1a1a;
    color: #fcf6ff;
    outline: none;
  }

  #searchInput:focus {
    border-color: #fce47e;
  }

  /* === Factions === */
  .faction-bar {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin: 25px 0;
  }

  .faction-icon {
    width: 50px;
    height: 50px;
    border: 2px solid transparent;
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s;
    object-fit: contain;
    background-color: #1a1a1a;
    padding: 4px;
  }

  .faction-icon:hover {
    transform: scale(1.1);
    border-color: #d4af37;
  }

  .faction-icon.active {
    border-color: #d4af37;
    transform: scale(1.1);
  }

  /* === Filtres === */
  .filters-wrapper {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
    margin-bottom: 25px;
  }

  .filter-section {
    text-align: center;
    width: 250px;
  }

  .section-label {
    font-weight: 600;
    color: #bbbbbb;
    margin-bottom: 8px;
  }

  .filter-buttons {
    display: grid;
    justify-items: center;
    gap: 8px;
  }

  .rarity-grid { grid-template-columns: repeat(3, 1fr); }
  .affinity-grid { grid-template-columns: repeat(2, 1fr); }
  .type-grid { grid-template-columns: repeat(2, 1fr); }

  .rarity-btn,
  .affinity-btn,
  .type-btn {
    background: none;
    border: 2px solid #555;
    color: #fcf6ff;
    border-radius: 8px;
    padding: 4px 8px;
    cursor: pointer;
    width: 60px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .rarity-btn img,
  .affinity-btn img {
    width: 24px;
    height: 24px;
    object-fit: contain;
  }

  .rarity-btn.active,
  .affinity-btn.active,
  .type-btn.active {
    border-color: #d4af37;
    box-shadow: 0 0 6px rgba(212, 175, 55, 0.4);
  }

  .rarity-btn:hover,
  .affinity-btn:hover,
  .type-btn:hover {
    border-color: #d4af37;
  }

  /* === Switch === */
  .checkbox-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 15px;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #444;
    border: 2px solid #d4af37;
    border-radius: 34px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 18px; width: 18px;
    left: 3px; bottom: 2px;
    background-color: #d4af37;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(212, 175, 55, 0.5);
    transition: 0.3s;
  }

  .switch input:checked + .slider {
    background-color: #d4af37;
  }

  .switch input:checked + .slider:before {
    transform: translateX(24px);
    background-color: #0e0e0e;
  }

  .checkbox-container label {
    font-weight: 600;
    font-size: 14px;
    color: #fcf6ff;
  }

  /* === Grille des champions === */
  .champion-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
    justify-items: center;
  }

  .champion-card {
    width: 100%;
    max-width: 140px;
    text-align: center;
    cursor: pointer;
  }

  .card-image {
    position: relative;
    aspect-ratio: 140 / 182;
    width: 100%;
    overflow: hidden;
  }

  /* Glow interne selon raret√© */
  .card-image::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    box-shadow: inset 0 0 22px rgba(0, 0, 0, 0.8);
  }

  .card-image.mythical::before   { box-shadow: inset 0 -2px 2px 12px rgba(0, 0, 0, 0.8); }
  .card-image.legendary::before  { box-shadow: inset 0 -2px 2px 11px rgba(0, 0, 0, 0.8); }
  .card-image.epic::before       { box-shadow: inset 0 -1px 2px 9px rgba(0, 0, 0, 0.8); }
  .card-image.rare::before       { box-shadow: inset 0 -1px 2px 8px rgba(0, 0, 0, 0.8); }
  .card-image.uncommon::before   { box-shadow: inset 0 -1px 2px 8px rgba(0, 0, 0, 0.8); }
  .card-image.common::before     { box-shadow: inset 0 0px 3px 6px rgba(0, 0, 0, 0.8); }

  .champion-img {
    position: relative;
    z-index: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .rarity-frame {
    position: absolute;
    inset: 0;
    z-index: 2;
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
  }

  .affinity-icon {
    position: absolute;
    bottom: 14px;
    left: 12px;
    width: 28px;
    height: 28px;
    object-fit: contain;
    pointer-events: none;
    z-index: 3;
  }

  .champion-name {
    font-size: 13px;
    font-weight: 600;
    margin-top: 6px;
  }

  .counter {
    text-align: center;
    margin-bottom: 15px;
    font-size: 15px;
    opacity: 0.8;
  }

  @media (max-width: 900px) {
    .filter-buttons { grid-template-columns: repeat(2, 1fr); }
    .filters-wrapper { flex-direction: column; align-items: center; }
  }

  @media (max-width: 700px) {
    #searchInput { width: 90%; }
    .champion-card { max-width: 100px; }
    .faction-icon { width: 40px; height: 40px; }
  }

  .sort-bar {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}

.sort-btn {
  background: #1a1a1a;
  border: 2px solid #555;
  color: #fcf6ff;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  transition: border-color .2s, background .2s;
}

.sort-btn svg {
  width: 18px;
  height: 18px;
}

.sort-btn.active {
  border-color: #d4af37;
  background: rgba(212, 175, 55, 0.15);
}

.sort-btn .sort-icon {
  opacity: .8;
}

/* === MODAL === */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.modal-overlay.active {
  display: flex;
}

.modal-content {
  background: #1a1a1a;
  border: 2px solid #d4af37;
  border-radius: 12px;
  padding: 20px;
  width: 500px;
  display: flex;
  gap: 25px;
  position: relative;
  box-shadow: 0 0 25px rgba(212,175,55,0.4);
}

.modal-close {
  position: absolute;
  right: 10px;
  top: 10px;
  background: none;
  border: none;
  cursor: pointer;
  color: #fcf6ff;
}

.modal-close svg {
  width: 26px;
  height: 26px;
}

.modal-left {
  flex: 1;
  display: flex;
  justify-content: center;
}

.modal-img-wrapper {
  position: relative;
  width: 140px;
  height: 182px;
}

.modal-champion-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.modal-frame-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.modal-right {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center; /* ‚¨Ö centre verticalement */
}

.modal-header-block {
  display: flex;
  align-items: center;
  gap: 15px;
}

.modal-icon {
  height: 32px;
  object-fit: contain;
}

.modal-name {
  text-align: center;
  font-family: 'American Captain', sans-serif;
  font-size: 36px;
  background: linear-gradient(to bottom, #feeec1, #e09f40);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1;
}

.modal-stats {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.stat-row {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 15px;
}

.stat-row svg {
  width: 20px;
  height: 20px;
}

/* === 3 COLONNES === */
.modal-content {
  background: #1a1a1a;
  border: 2px solid #d4af37;
  padding: 20px;
  width: 900px;
  display: flex;
  gap: 20px;
  position: relative;
  box-shadow: 0 0 25px rgba(212,175,55,0.4);
}

.modal-col {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 33%;
  gap: 15px;
}

/* Diviseur vertical */
.modal-divider {
  width: 2px;
  background: rgba(212,175,55,0.4);
  border-radius: 2px;
}

/* Banni√®re faction */
.modal-faction-banner {
  height: 240px;
  object-fit: contain;
}

/* Image du champion */
.modal-img-wrapper {
  position: relative;
  width: 140px;
  height: 182px;
}

.modal-champion-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.modal-frame-img {
  position: absolute;
  inset: 0;
  width: 100%;
  pointer-events: none;
}

.modal-affinity-big {
  position: absolute;
  bottom: 15px;
  left: 12px;
  width: 32px;
  height:32px;
  z-index: 3;
  pointer-events: none;
}

/* Nom */
.modal-name {
  text-align: center;
  font-family: 'American Captain', sans-serif;
  font-size: 32px;
  background: linear-gradient(to bottom, #feeec1, #e09f40);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Stats */
.stats-col {
  justify-content: center;
}

.modal-stats {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.stat-left {
  display: flex;
  align-items: center;
  gap: 8px;
}

.stat-left span {
  font-size: 16px;
}

.stat-row svg {
  width: 22px;
  height: 22px;
}

.stat-value {
  font-size: 16px;
  font-weight: 600;
  text-align: right;
  min-width: 60px;
}

.modal-col-title {
  font-family: 'American Captain', sans-serif;
  font-size: 32px;
  text-align: center;
  background: linear-gradient(to bottom, #feeec1, #e09f40);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 1px;
  margin-bottom: 10px;
}
/* Zone comparatif */
.compare-header {
  font-size: 13px;
  margin-bottom: 6px;
  opacity: 0.85;
}
.compare-header span {
  font-weight: 600;
}

/* Input + suggestions */
.compare-input-wrapper {
  width: 100%;
  margin-bottom: 8px;
}

.compare-input {
  width: 100%;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #555;
  background: #0e0e0e;
  color: #fcf6ff;
  font-size: 13px;
  outline: none;
}

.compare-input:focus {
  border-color: #d4af37;
}

.compare-suggestions {
  margin-top: 4px;
  background: #111;
  border-radius: 6px;
  border: 1px solid #333;
  max-height: 140px;
  overflow-y: auto;
}

.compare-suggestion {
  padding: 4px 8px;
  font-size: 13px;
  cursor: pointer;
}

.compare-suggestion:hover {
  background: #222;
}

/* Bouton Compare en bas √† droite du modal */
.compare-toggle {
  position: absolute;
  right: 16px;
  bottom: 16px;
  background: none;
  padding: 6px 8px;
  border:none;
  color: #fcf6ff;
  display: flex;
  align-items: center;
  justify-content: center;
}

.compare-toggle svg {
  width: 18px;
  height: 18px;
}

/* Affichage des valeurs + pourcentages */
.stat-value {
  font-size: 16px;
  font-weight: 600;
  text-align: right;
  min-width: 60px;
}

.stat-main-line {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  font-size: 14px;
}

.stat-number {
  min-width: 40px;
  text-align: right;
}

.stat-percent {
  min-width: 44px;
  text-align: right;
  font-size: 12px;
  opacity: 0.9;
}

.stat-percent.positive {
  color: #00c86b;
}

.stat-percent.negative {
  color: #f52584;
}


  </style>
</head>

<body>

<div id="menu-container"></div>

<div class="header-wrapper">
  <header id="page-title">CHAMPIONS INDEX</header>
</div> 

<div class="container">
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search a champion...">
  </div>

  <div class="faction-bar" id="factionBar"></div>

  <!-- FILTER SECTIONS -->
  <div class="filters-wrapper">
    <!-- Rarity -->
    <div class="filter-section">
      <div class="section-label">Rarity</div>
      <div class="filter-buttons rarity-grid">
        <button class="rarity-btn" data-rarity="Mythical"><img src="/tools/champions-index/img/rarity/Mythical_Icon.webp"></button>
        <button class="rarity-btn" data-rarity="Legendary"><img src="/tools/champions-index/img/rarity/Legendary_Icon.webp"></button>
        <button class="rarity-btn" data-rarity="Epic"><img src="/tools/champions-index/img/rarity/Epic_Icon.webp"></button>
        <button class="rarity-btn" data-rarity="Rare"><img src="/tools/champions-index/img/rarity/Rare_Icon.webp"></button>
        <button class="rarity-btn" data-rarity="Uncommon"><img src="/tools/champions-index/img/rarity/Uncommon_Icon.webp"></button>
        <button class="rarity-btn" data-rarity="Common"><img src="/tools/champions-index/img/rarity/Common_Icon.webp"></button>
      </div>
    </div>

    <!-- Affinity -->
    <div class="filter-section">
      <div class="section-label">Affinity</div>
      <div class="filter-buttons affinity-grid">
        <button class="affinity-btn" data-affinity="Force"><img src="/tools/champions-index/img/affinity/Force.webp"></button>
        <button class="affinity-btn" data-affinity="Magic"><img src="/tools/champions-index/img/affinity/Magic.webp"></button>
        <button class="affinity-btn" data-affinity="Spirit"><img src="/tools/champions-index/img/affinity/Spirit.webp"></button>
        <button class="affinity-btn" data-affinity="Void"><img src="/tools/champions-index/img/affinity/Void.webp"></button>
      </div>
    </div>

    <!-- Type -->
    <div class="filter-section">
      <div class="section-label">Type</div>
      <div class="filter-buttons type-grid">
        <button class="type-btn" data-type="HP">HP</button>
        <button class="type-btn" data-type="Attack">Attack</button>
        <button class="type-btn" data-type="Defense">Defense</button>
        <button class="type-btn" data-type="Support">Support</button>
      </div>
    </div>
  </div>

  <div class="sort-bar">
    <button class="sort-btn" data-stat="hp">
      <i data-lucide="heart"></i>
      <i class="sort-icon" data-lucide="arrow-down-wide-narrow"></i>
    </button>

    <button class="sort-btn" data-stat="atk">
      <i data-lucide="swords"></i>
      <i class="sort-icon" data-lucide="arrow-down-wide-narrow"></i>
    </button>

    <button class="sort-btn" data-stat="def">
      <i data-lucide="shield"></i>
      <i class="sort-icon" data-lucide="arrow-down-wide-narrow"></i>
    </button>

    <button class="sort-btn" data-stat="spd">
      <i data-lucide="chevrons-up"></i>
      <i class="sort-icon" data-lucide="arrow-down-wide-narrow"></i>
    </button>
  </div>

  <div class="checkbox-container">
    <label for="invocableOnly">Hide Non-Summonable Champions</label>
    <label class="switch">
      <input type="checkbox" id="invocableOnly">
      <span class="slider"></span>
    </label>
  </div>

  <div class="counter" id="championCount"></div>
  <div id="championGrid" class="champion-grid"></div>
</div>

<!-- === MODAL CHAMPION === -->
<div id="championModal" class="modal-overlay">
  <div class="modal-content">

    <button class="modal-close">
      <i data-lucide="x"></i>
    </button>

    <div class="modal-col faction-col">
      <div id="modalFactionTitle" class="modal-col-title"></div>
      <img id="modalFactionBanner" class="modal-faction-banner" src="">
    </div>

    <div class="modal-divider"></div>

    <div class="modal-col champion-col">
      <div id="modalChampionTitle" class="modal-col-title"></div>

      <div class="modal-img-wrapper">
        <img id="modalChampionImg" class="modal-champion-img" src="">
        <img id="modalFrameImg" class="modal-frame-img" src="">
        <img id="modalAffinityBig" class="modal-affinity-big" src="">
      </div>
    </div>

    <div class="modal-divider"></div>

    <div class="modal-col stats-col">
  <div id="modalStatsTitle" class="modal-col-title">STATS</div>

  <!-- Header comparatif -->
  <div class="compare-header" id="compareHeader" style="display:none;">
    Comparing with <span id="compareTargetName"></span>
  </div>

  <!-- Input de recherche pour le comparatif -->
  <div class="compare-input-wrapper" id="compareInputWrapper" style="display:none;">
    <input type="text" id="compareInput" class="compare-input" placeholder="Type a champion name..." autocomplete="off">
    <div class="compare-suggestions" id="compareSuggestions"></div>
  </div>

  <!-- Stats -->
  <div class="modal-stats">

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="heart"></i><span>HP</span></div>
      <div class="stat-value" id="statHP"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="swords"></i><span>ATK</span></div>
      <div class="stat-value" id="statATK"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="shield"></i><span>DEF</span></div>
      <div class="stat-value" id="statDEF"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="chevrons-up"></i><span>SPD</span></div>
      <div class="stat-value" id="statSPD"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="circle-divide"></i><span>C.RATE</span></div>
      <div class="stat-value" id="statCRATE"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="circle-percent"></i><span>C.DMG</span></div>
      <div class="stat-value" id="statCDMG"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="shield-plus"></i><span>RES</span></div>
      <div class="stat-value" id="statRES"></div>
    </div>

    <div class="stat-row">
      <div class="stat-left"><i data-lucide="locate-fixed"></i><span>ACC</span></div>
      <div class="stat-value" id="statACC"></div>
    </div>

  </div>

  <!-- Bouton Compare / Close compare -->
  <button class="compare-toggle" id="compareToggle">
    <i data-lucide="arrow-right-left"></i>
  </button>

</div>

      </div>
    </div>

  </div>
</div>



<script>

let champions = [];
let factions = [];

const grid = document.getElementById('championGrid');
const factionBar = document.getElementById('factionBar');
const searchInput = document.getElementById('searchInput');
const rarityButtons = document.querySelectorAll('.rarity-btn');
const affinityButtons = document.querySelectorAll('.affinity-btn');
const typeButtons = document.querySelectorAll('.type-btn');
const invocableCheckbox = document.getElementById('invocableOnly');
const countDisplay = document.getElementById('championCount');

let selectedFaction = null;
let selectedRarities = [];
let selectedAffinities = [];
let selectedTypes = [];
let currentSort = { stat: null, order: "asc" }; 

document.addEventListener("DOMContentLoaded", () => {

  initSqlJs({
    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
  }).then(SQL => {
    
    fetch("/tools/champions-index/champions.db") // üî• Ajuste le chemin selon ton site !
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const db = new SQL.Database(new Uint8Array(buffer));
        
        const result = db.exec("SELECT * FROM champions;");
        
        if (!result.length) {
          console.error("La table champions semble vide ou introuvable");
          return;
        }

        champions = result[0].values.map(r => ({
          id: r[0],
          name: r[1],
          faction: r[2],
          rarity: r[3],
          affinity: r[4],
          type: r[5],
          image: r[6],
          invocable: r[7] === 1,
          hp: Number(r[8]) || 0,
          atk: Number(r[9]) || 0,
          def: Number(r[10]) || 0,
          spd: Number(r[11]) || 0,
          crate: Number(r[12]) || 0,
          cdmg: Number(r[13]) || 0,
          res: Number(r[14]) || 0,
          acc: Number(r[15]) || 0
        }));

        factions = [...new Set(champions.map(c => c.faction))].sort();

        renderFactions();
        displayChampions();
      })
      .catch(err => console.error("Erreur chargement champions.db :", err));

  });

});

function renderFactions() {
  factions.forEach(f => {
    const img = document.createElement('img');
    const icon = f.toLowerCase().replace(/ /g, "");
    img.src = `/tools/champions-index/img/factions/${icon}.webp`;
    img.alt = f;
    img.classList.add('faction-icon');
    img.dataset.faction = f;

    img.addEventListener('click', () => {
      document.querySelectorAll('.faction-icon').forEach(i => i.classList.remove('active'));
      if (selectedFaction === f) selectedFaction = null;
      else {
        selectedFaction = f;
        img.classList.add('active');
      }
      displayChampions();
    });

    factionBar.appendChild(img);
  });
}

function toggleSelection(array, value) {
  return array.includes(value) ? array.filter(v => v !== value) : [...array, value];
}

searchInput.addEventListener('input', displayChampions);
invocableCheckbox.addEventListener('change', displayChampions);

rarityButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.toggle('active');
    selectedRarities = toggleSelection(selectedRarities, btn.dataset.rarity);
    displayChampions();
  });
});

affinityButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.toggle('active');
    selectedAffinities = toggleSelection(selectedAffinities, btn.dataset.affinity);
    displayChampions();
  });
});

typeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.toggle('active');
    selectedTypes = toggleSelection(selectedTypes, btn.dataset.type);
    displayChampions();
  });
});

document.querySelectorAll(".sort-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const stat = btn.dataset.stat;

    // ---- Gestion des 3 clics ----
    if (currentSort.stat !== stat) {
      // 1er clic ‚Üí DESC
      currentSort.stat = stat;
      currentSort.order = "desc";
    } else if (currentSort.order === "desc") {
      // 2e clic ‚Üí ASC
      currentSort.order = "asc";
    } else {
      // 3e clic ‚Üí Reset complet
      currentSort.stat = null;
      currentSort.order = "asc";

      // RESET VISUEL COMPLET
      document.querySelectorAll(".sort-btn").forEach(b => {
        b.classList.remove("active");

        // remet l‚Äôic√¥ne en "down" par d√©faut
        const icon = b.querySelector(".sort-icon");
        icon.setAttribute("data-lucide", "arrow-down-wide-narrow");
      });

      lucide.createIcons();
      displayChampions();
      return;
    }

    // ---- Mise √† jour visuelle ----
    document.querySelectorAll(".sort-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    // ic√¥ne up/down selon ordre
    const icon = btn.querySelector(".sort-icon");
    icon.setAttribute("data-lucide",
      currentSort.order === "desc"
        ? "arrow-down-wide-narrow"
        : "arrow-up-wide-narrow"
    );

    lucide.createIcons();
    displayChampions();
  });
});


function displayChampions() {
  const searchTerm = searchInput.value.toLowerCase();
  const invocableOnly = invocableCheckbox.checked;

  const filtered = champions.filter(c => {
    const matchesName = c.name.toLowerCase().includes(searchTerm);
    const matchesFaction = !selectedFaction || c.faction === selectedFaction;
    const matchesRarity = selectedRarities.length === 0 || selectedRarities.includes(c.rarity);
    const matchesAffinity = selectedAffinities.length === 0 || selectedAffinities.includes(c.affinity);
    const matchesType = selectedTypes.length === 0 || selectedTypes.includes(c.type);
    const matchesInvocable = !invocableOnly || c.invocable;
    return matchesName && matchesFaction && matchesRarity && matchesAffinity && matchesType && matchesInvocable;
  });

  grid.innerHTML = "";

  // ==== UNIQUE MYTHICAL HANDLING ====
  const unique = [];
  const seen = new Set();

  filtered.forEach(c => {
    if (!seen.has(c.name)) {
      unique.push(c);
      seen.add(c.name);
    }
  });

  // ==== COUNTER ====
  countDisplay.textContent =
    `${unique.length} champion${unique.length !== 1 ? 's' : ''} found`;


  // === TRI ===
  if (currentSort.stat) {
    unique.sort((a, b) => {
      const valA = Number(a[currentSort.stat]) || 0;
      const valB = Number(b[currentSort.stat]) || 0;

      return currentSort.order === "asc"
        ? valA - valB
        : valB - valA;
    });
  }

  unique.forEach(c => {
    const card = document.createElement('div');
    card.classList.add('champion-card');

    const imgWrapper = document.createElement('div');
    imgWrapper.classList.add('card-image', c.rarity.toLowerCase());

    const img = document.createElement('img');
    img.src = `/tools/champions-index/img/champions/${c.image}.webp`;
    img.alt = c.name;
    img.loading = "lazy";
    img.classList.add('champion-img');

    const frame = document.createElement('img');
    frame.src = `/tools/champions-index/img/rarity/${c.rarity}.webp`;
    frame.alt = `${c.rarity} frame`;
    frame.classList.add('rarity-frame');

    const affinity = document.createElement('img');
    affinity.src = `/tools/champions-index/img/affinity/${c.affinity}.webp`;
    affinity.alt = `${c.affinity} affinity`;
    affinity.classList.add('affinity-icon');

    const name = document.createElement('div');
    name.classList.add('champion-name');
    name.textContent = c.name;

    imgWrapper.appendChild(img);
    imgWrapper.appendChild(frame);
    imgWrapper.appendChild(affinity);
    card.appendChild(imgWrapper);
    card.appendChild(name);

    if (currentSort.stat) {
      const statValue = document.createElement("div");
      statValue.style.fontSize = "12px";
      statValue.style.opacity = "0.8";
      statValue.style.marginTop = "2px";
      statValue.textContent = c[currentSort.stat];
      card.appendChild(statValue);
    }

    card.addEventListener("click", () => openChampionModal(c));
    grid.appendChild(card);
  });

  if (unique.length === 0) {
    grid.innerHTML = '<p style="grid-column: 1 / -1; text-align:center;">No champions found.</p>';
  }
}

const modal = document.getElementById("championModal");

let primaryChampion = null;
let compareChampion = null;

const compareToggle = document.getElementById("compareToggle");
const compareHeader = document.getElementById("compareHeader");
const compareTargetName = document.getElementById("compareTargetName");
const compareInputWrapper = document.getElementById("compareInputWrapper");
const compareInput = document.getElementById("compareInput");
const compareSuggestions = document.getElementById("compareSuggestions");

const STAT_CONFIG = [
  { key: "hp",   id: "statHP",   isPercent: false },
  { key: "atk",  id: "statATK",  isPercent: false },
  { key: "def",  id: "statDEF",  isPercent: false },
  { key: "spd",  id: "statSPD",  isPercent: false },
  { key: "crate",id: "statCRATE",isPercent: true  },
  { key: "cdmg", id: "statCDMG", isPercent: true  },
  { key: "res",  id: "statRES",  isPercent: false },
  { key: "acc",  id: "statACC",  isPercent: false }
];

function formatValue(val, isPercent) {
  if (isNaN(val)) return "‚Äî";
  return isPercent ? `${val}%` : val;
}

function formatPercent(p) {
  if (!isFinite(p)) return "0%";
  const rounded = Math.round(p);
  const sign = rounded > 0 ? "+" : "";
  return `${sign}${rounded}%`;
}

function updateStatsDisplay(primary, secondary = null) {
  STAT_CONFIG.forEach(cfg => {
    const el = document.getElementById(cfg.id);
    if (!el) return;

    const p = primary[cfg.key] ?? 0;

    // mode normal (pas de comparatif)
    if (!secondary) {
      el.textContent = formatValue(p, cfg.isPercent);
      return;
    }

    const s = secondary[cfg.key] ?? 0;

    // Calcul du pourcentage par rapport au second champion
    const pct = s ? ((p - s) / s) * 100 : 0;
    const pctClass = pct >= 0 ? "positive" : "negative";

    // Affichage : une seule ligne
    el.innerHTML = `
      <div class="stat-main-line">
        <span class="stat-number">${formatValue(p, cfg.isPercent)}</span>
        <span class="stat-percent ${pctClass}">${formatPercent(pct)}</span>
      </div>
    `;
  });
}

function resetCompareUI() {
  compareChampion = null;
  compareHeader.style.display = "none";
  compareTargetName.textContent = "";
  compareInputWrapper.style.display = "none";
  compareSuggestions.innerHTML = "";
  compareToggle.dataset.mode = "off";
  compareToggle.innerHTML = `<i data-lucide="arrow-right-left"></i>`;
  lucide.createIcons();
}


function openChampionModal(champ) {
  primaryChampion = champ;
  resetCompareUI();

  document.getElementById("modalChampionImg").src = `/tools/champions-index/img/champions/${champ.image}.webp`;
  document.getElementById("modalFrameImg").src = `/tools/champions-index/img/rarity/${champ.rarity}.webp`;

  document.getElementById("modalFactionBanner").src =
    `/tools/champions-index/img/factions/${champ.faction.toLowerCase().replace(/ /g,'')}.webp`;
  document.getElementById("modalAffinityBig").src =
    `/tools/champions-index/img/affinity/${champ.affinity}.webp`;

  document.getElementById("modalFactionTitle").textContent = champ.faction;
  document.getElementById("modalChampionTitle").textContent = champ.name;
  document.getElementById("modalStatsTitle").textContent = champ.type;

  // stats de base (sans comparatif)
  updateStatsDisplay(primaryChampion, null);

  modal.classList.add("active");
  lucide.createIcons();
}

compareToggle.addEventListener("click", () => {
  const mode = compareToggle.dataset.mode || "off";

  // OFF -> passage en s√©lection (affiche input)
  if (mode === "off") {
    compareToggle.dataset.mode = "select";
    compareToggle.innerHTML = `<i data-lucide="x"></i>`;
    compareInputWrapper.style.display = "block";
    compareHeader.style.display = "none";
    compareInput.value = "";
    compareSuggestions.innerHTML = "";
    compareInput.focus();
    updateStatsDisplay(primaryChampion, null);
    lucide.createIcons();
    return;
  }

  // SELECT ou ON -> reset (fermer le comparatif)
  resetCompareUI();
  updateStatsDisplay(primaryChampion, null);
});

function selectCompareChampion(champ) {
  compareChampion = champ;
  compareToggle.dataset.mode = "on";

  compareHeader.style.display = "block";
  compareTargetName.textContent = champ.name;

  compareInputWrapper.style.display = "none";
  compareSuggestions.innerHTML = "";

  updateStatsDisplay(primaryChampion, compareChampion);
}

compareInput.addEventListener("input", () => {
  const query = compareInput.value.toLowerCase();
  compareSuggestions.innerHTML = "";
  if (!query) return;

  const matches = champions
    .filter(c =>
      primaryChampion &&
      c.id !== primaryChampion.id &&
      c.name.toLowerCase().includes(query)
    )
    .slice(0, 8);

  matches.forEach(c => {
    const item = document.createElement("div");
    item.className = "compare-suggestion";
    item.textContent = c.name;
    item.addEventListener("click", () => selectCompareChampion(c));
    compareSuggestions.appendChild(item);
  });
});

compareInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const query = compareInput.value.toLowerCase();
    let match = champions.find(c =>
      primaryChampion &&
      c.id !== primaryChampion.id &&
      c.name.toLowerCase() === query
    );

    if (!match && compareSuggestions.firstElementChild) {
      const name = compareSuggestions.firstElementChild.textContent;
      match = champions.find(c => c.name === name);
    }

    if (match) {
      selectCompareChampion(match);
    }
  }
});


document.querySelector(".modal-close").addEventListener("click", () => {
  modal.classList.remove("active");
});

modal.addEventListener("click", e => {
  if (e.target === modal) modal.classList.remove("active");
});
</script>

  <div class="adsense-container">
    <div class="ad-label">Advertisement</div>

    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8653563887265027"
     data-ad-slot="9042028911"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>

    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>

<script src="/script.js"></script>
</body>
</html>
