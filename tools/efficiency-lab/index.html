<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HNK5S7EBCJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-HNK5S7EBCJ');
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <meta charset="UTF-8">
  <script src="/config/site-config.js"></script>
  <script>document.title = "Efficiency Lab | " + window.siteConfig.title;</script>
  <link rel="stylesheet" href="/style/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="preload" href="/menu.html" as="fetch" crossorigin>
  <style>
    * { box-sizing: border-box; }

    .main-container {
      width: min(1100px, 95%);
      margin: 30px auto;
      padding: 0 20px;
    }

    /* Selection Panel */
    .selection-panel {
      background: var(--bg2);
      border: 2px solid var(--gold);
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 0 18px rgba(212, 175, 55, 0.25);
    }

    .section-title {
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 15px;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .dropdown-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      opacity: 0;
      animation: fadeInSlide 0.3s ease forwards;
    }

    @keyframes fadeInSlide {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .input-group.hidden {
      display: none;
    }

    .input-label {
      color: var(--text);
      font-size: 13px;
      font-weight: 500;
    }

    .styled-select {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid var(--gray);
      border-radius: 8px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 14px;
      transition: all 0.25s ease;
      outline: none;
    }

    .styled-select:hover {
      border-color: var(--gold);
    }

    .styled-select:focus {
      border-color: var(--gold);
      box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
    }

    .styled-select option {
      background: var(--bg);
      color: var(--text);
    }

    /* Points Section */
    .points-panel {
      background: var(--bg2);
      border: 2px solid var(--gold);
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 0 18px rgba(212, 175, 55, 0.25);
    }

    .points-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .points-input-box {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid var(--gray);
      border-radius: 8px;
      padding: 15px;
      transition: all 0.25s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .points-input-box:hover {
      border-color: var(--gold);
    }

    .points-input-box label {
      display: block;
      color: var(--gold);
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .points-input-box input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 24px;
      font-weight: 700;
      outline: none;
      text-align: center;
    }

    .remaining-box {
      background: linear-gradient(145deg, #141414, #1b1b1b);
      border: 2px solid var(--gold);
      border-radius: 8px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .remaining-label {
      color: var(--gold);
      font-size: 13px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .remaining-value {
      color: var(--text);
      font-size: 24px;
      font-weight: 700;
    }

    /* Cost Section */
    .cost-section {
      margin-bottom: 25px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.3s ease, max-height 0.3s ease;
    }

    .cost-section.visible {
      opacity: 1;
      max-height: 600px;
    }

    .cost-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .cost-box {
      background: var(--bg2);
      border: 2px solid var(--gold);
      border-radius: 10px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 0 18px rgba(212, 175, 55, 0.25);
      min-height: 140px;
    }

    .cost-icon {
      width: 48px;
      height: 48px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      filter: drop-shadow(0 0 6px rgba(212, 175, 55, 0.25));
    }

    .cost-value {
      font-weight: 700;
      font-size: 24px;
      color: var(--gold);
      letter-spacing: 0.3px;
    }

    .cost-label {
      font-size: 13px;
      color: var(--text);
      font-weight: 500;
      text-transform: uppercase;
    }

    .cost-hint {
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
      font-style: italic;
      text-align: center;
      margin-top: 0;
    }

    /* Table Section */
    .table-panel {
      margin-bottom: 25px;
      overflow-x: auto;
    }

    #points-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 2px solid #3a3a3a !important;
      border-radius: 10px;
      overflow: hidden;
    }

    #points-table thead th {
      background: rgba(0, 0, 0, 0.6) !important;
      color: #d4af37 !important;
      -webkit-text-fill-color: #d4af37 !important;
      -webkit-background-clip: unset !important;
      background-clip: unset !important;
      padding: 12px 10px !important;
      font-weight: 600;
      text-align: center;
      border-bottom: 1px solid #3a3a3a !important;
      border-right: 1px solid #3a3a3a !important;
      font-size: 14px;
    }

    #points-table thead th:last-child {
      border-right: none !important;
    }

    #points-table thead th:first-child {
      border-top-left-radius: 10px;
      padding: 0;
    }

    #points-table thead th:last-child {
      border-top-right-radius: 10px;
    }

    #points-table tbody td {
      padding: 10px !important;
      text-align: center;
      color: var(--text);
      border-bottom: 1px solid #3a3a3a !important;
      border-right: 1px solid #3a3a3a !important;
      background-color: transparent !important;
      transition: all 0.2s ease;
      font-size: 13px;
    }

    #points-table tbody td:last-child {
      border-right: none !important;
    }

    #points-table tbody tr:last-child td {
      border-bottom: none !important;
    }

    #points-table tbody tr:last-child td:first-child {
      border-bottom-left-radius: 10px;
    }

    #points-table tbody tr:last-child td:last-child {
      border-bottom-right-radius: 10px;
    }

    #points-table tbody td:first-child {
      background: rgba(0, 0, 0, 0.6) !important;
      font-weight: 600;
      color: var(--text);
      text-align: left;
    }

    #points-table tbody tr:hover {
      background: rgba(212, 175, 55, 0.1);
    }

    /* Toggle in table header */
    .rarity-cell {
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.2s ease;
      padding: 12px 10px;
      width: 100%;
      height: 100%;
      color: #d4af37 !important;
      -webkit-text-fill-color: #d4af37 !important;
      -webkit-background-clip: unset !important;
      background-clip: unset !important;
    }

    .rarity-cell:hover {
      color: #f1f5f9 !important;
      -webkit-text-fill-color: #f1f5f9 !important;
    }

    .rarity-cell svg {
      width: 16px;
      height: 16px;
    }

    /* Rarity colors */
    #points-table tbody tr:nth-child(1) td:first-child {
      color: #999 !important; /* Common - Gris */
    }

    #points-table tbody tr:nth-child(2) td:first-child {
      color: #4ade80 !important; /* Uncommon - Vert */
    }

    #points-table tbody tr:nth-child(3) td:first-child {
      color: #3b82f6 !important; /* Rare - Bleu */
    }

    #points-table tbody tr:nth-child(4) td:first-child {
      color: #a855f7 !important; /* Epic - Violet */
    }

    #points-table tbody tr:nth-child(5) td:first-child {
      color: #fbbf24 !important; /* Legendary - Jaune doré */
    }

    #points-table tbody tr:nth-child(6) td:first-child {
      color: #ef4444 !important; /* Mythical - Rouge */
    }

    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .dropdown-grid {
        grid-template-columns: 1fr;
      }

      .points-grid {
        grid-template-columns: 1fr;
      }

      .cost-grid {
        grid-template-columns: 1fr;
      }

      .cost-box {
        min-height: auto;
        padding: 15px;
      }

      .table-panel {
        overflow-x: auto;
      }

      #points-table {
        font-size: 11px;
      }

      #points-table thead th,
      #points-table tbody td {
        padding: 8px 5px;
      }
    }
  </style>
</head>
<body>

<!-- BARRE DE MENU CENTRÉE -->
<div id="menu-container"></div>

<div class="header-wrapper">
  <header id="page-title">EFFICIENCY LAB</header>
</div>

<div class="main-container">
  <!-- Selection Panel -->
  <div class="selection-panel">
    <div class="section-title">Event & Zone Selection</div>
    <div class="dropdown-grid">
      <div class="input-group">
        <label class="input-label">Event Type</label>
        <select id="event-type" class="styled-select">
          <option value="">-- Event Type --</option>
          <option value="tournament">Tournament</option>
          <option value="gearhunters">Gear Hunters</option>
          <option value="herospath">Hero's Path</option>
          <option value="deckoffate">Deck of Fate</option>
        </select>
      </div>

      <div class="input-group">
        <label class="input-label">Zone</label>
        <select id="zone" class="styled-select">
          <option value="">-- Zone --</option>
          <option value="dungeons">Fire Knight / Ice Golem / Dragon</option>
          <option value="spider">Spider</option>
          <option value="eventdungeon">Event Dungeon</option>
          <option value="campaign">Campaign</option>
        </select>
      </div>

      <!-- Campagne -->
      <div class="input-group hidden" id="campaign-difficulty-group">
        <label class="input-label">Campaign Difficulty</label>
        <select id="campaign-difficulty" class="styled-select">
          <option value="">-- Difficulty --</option>
          <option value="Normal">Normal</option>
          <option value="Hard">Hard</option>
          <option value="Brutal">Brutal</option>
          <option value="Nightmare">Nightmare</option>
        </select>
      </div>

      <div class="input-group hidden" id="campaign-stage-group">
        <label class="input-label">Campaign Stage</label>
        <select id="campaign-stage" class="styled-select">
          <option value="">-- Stage --</option>
        </select>
      </div>

      <!-- Donjons & Spider & Event Dungeon -->
      <div class="input-group hidden" id="dungeon-difficulty-group">
        <label class="input-label">Dungeon Difficulty</label>
        <select id="dungeon-difficulty" class="styled-select">
          <option value="">-- Difficulty --</option>
          <option value="normal">Normal</option>
          <option value="hard">Hard</option>
        </select>
      </div>

      <div class="input-group hidden" id="dungeon-stage-group">
        <label class="input-label">Dungeon Stage</label>
        <select id="dungeon-stage" class="styled-select">
          <option value="">-- Stage --</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Points Section -->
  <div class="points-panel">
    <div class="section-title">Points Tracking</div>
    <div class="points-grid">
      <div class="points-input-box">
        <label for="current-points">Current Points</label>
        <input type="number" id="current-points" min="0" value="0">
      </div>
      <div class="points-input-box">
        <label for="target-points">Target Points</label>
        <input type="number" id="target-points" min="0" value="0">
      </div>
      <div class="remaining-box">
        <span class="remaining-label">Remaining</span>
        <span id="points-remaining" class="remaining-value">0</span>
      </div>
    </div>
  </div>

  <!-- Cost Section (hidden by default) -->
  <div class="cost-section" id="cost-section">
    <div class="cost-grid">
      <div class="cost-box">
        <div class="cost-icon" style="background-image:url('/style/img/Misc/Energy.webp');"></div>
        <div class="cost-value" id="energy-value">0</div>
        <div class="cost-label">Energy</div>
      </div>
      <div class="cost-box">
        <div class="cost-icon" style="background-image:url('/style/img/Misc/Gems.webp');"></div>
        <div class="cost-value" id="gems-value">0</div>
        <div class="cost-label">Gems</div>
      </div>
      <div class="cost-box">
        <div class="cost-value" id="runs-value">0</div>
        <div class="cost-label">Runs</div>
        <div class="cost-hint" id="runs-hint">Total runs needed</div>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div id="points-table-container" class="table-panel hidden">
    <table id="points-table">
      <thead>
        <tr>
          <th>
            <div class="rarity-cell" id="toggle-cell">
              <i data-lucide="hash"></i>
              <span id="toggle-text">Points</span>
            </div>
          </th>
          <th>Rank 1 ⭐</th>
          <th>Rank 2 ⭐</th>
          <th>Rank 3 ⭐</th>
          <th>Rank 4 ⭐</th>
          <th>Rank 5 ⭐</th>
          <th>Rank 6 ⭐</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Common</td></tr>
        <tr><td>Uncommon</td></tr>
        <tr><td>Rare</td></tr>
        <tr><td>Epic</td></tr>
        <tr><td>Legendary</td></tr>
        <tr><td>Mythical</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="adsense-container">
  <div class="ad-label">Advertisement</div>
  <ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-8653563887265027"
   data-ad-slot="9042028911"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<script>
const rarities = ['Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Mythical'];
const pointsTableContainer = document.getElementById('points-table-container');
const pointsTableBody = document.getElementById('points-table').querySelector('tbody');
const costSection = document.getElementById('cost-section');

const zoneSelect = document.getElementById('zone');
const dungeonDifficultySelect = document.getElementById('dungeon-difficulty');
const dungeonStageSelect = document.getElementById('dungeon-stage');
const campaignDifficultySelect = document.getElementById('campaign-difficulty');
const campaignStageSelect = document.getElementById('campaign-stage');
const eventTypeSelect = document.getElementById('event-type');

const currentPointsInput = document.getElementById('current-points');
const targetPointsInput = document.getElementById('target-points');
const pointsRemainingSpan = document.getElementById('points-remaining');

const energyValue = document.getElementById('energy-value');
const gemsValue = document.getElementById('gems-value');
const runsValue = document.getElementById('runs-value');
const runsHint = document.getElementById('runs-hint');

const toggleCell = document.getElementById('toggle-cell');
const toggleText = document.getElementById('toggle-text');

let pointsData = {};
let displayMode = 'points';

// --- Chargement du JSON ---
fetch('/tools/efficiency-lab/points-data.json')
  .then(res => res.json())
  .then(data => pointsData = data)
  .catch(err => console.error('Erreur chargement points:', err));

// --- Table ---
function generateEmptyPointsTable() {
  pointsTableBody.innerHTML = '';
  rarities.forEach(rarity => {
    const tr = document.createElement('tr');
    const tdRarity = document.createElement('td');
    tdRarity.textContent = rarity;
    tr.appendChild(tdRarity);
    for (let i = 1; i <= 6; i++) {
      const td = document.createElement('td');
      td.textContent = '0';
      tr.appendChild(td);
    }
    pointsTableBody.appendChild(tr);
  });
}

function fillPointsTable(eventType) {
  if (!pointsData.points?.[eventType]) {
    console.log('No points data for event type:', eventType);
    return;
  }

  rarities.forEach((rarity, rowIndex) => {
    const tr = pointsTableBody.rows[rowIndex];
    if (!tr) return;

    const values = pointsData.points[eventType][rarity];
    if (!values) return;

    for (let col = 1; col <= 6; col++) {
      const cell = tr.cells[col];
      if (!cell) continue;

      cell.textContent = values[col-1] || 0;
      cell.style.backgroundColor = '';
      cell.style.color = 'var(--text)';
    }
  });
}

// --- Loot ---
function getCampaignStageData(difficulty, stage) {
  if (!difficulty || !stage) return null;
  const campaignData = pointsData.loot.campaign?.[difficulty];
  if (!campaignData) return null;
  for (const key of Object.keys(campaignData)) {
    if (key.includes('-')) {
      const [start, end] = key.split('-').map(Number);
      if (stage >= start && stage <= end) return campaignData[key];
    } else if (parseInt(key) === stage) {
      return campaignData[key];
    }
  }
  return null;
}

function getLoot() {
  const zone = zoneSelect.value;
  if (!pointsData.loot) return null;

  if (zone === 'campaign') {
    const difficulty = campaignDifficultySelect.value;
    const stage = Number(campaignStageSelect.value);
    if (difficulty && stage) return getCampaignStageData(difficulty, stage);
    return null;

  } else if (zone === 'dungeons') {
    const difficulty = dungeonDifficultySelect.value;
    const stage = dungeonStageSelect.value;
    if (difficulty && stage) return pointsData.loot.dungeons?.[difficulty]?.[stage] || null;
    return null;

  } else if (zone === 'spider') {
    const difficulty = dungeonDifficultySelect.value;
    const stage = dungeonStageSelect.value;
    if (difficulty && stage) return pointsData.loot.spider?.[difficulty]?.[stage] || null;
    return null;

  } else if (zone === 'eventdungeon') {
    const stage = dungeonStageSelect.value;
    if (stage) return pointsData.loot.eventdungeon?.normal?.[stage] || null;
    return null;
  }

  return null;
}

function getEnergy() {
  const loot = getLoot();
  return loot ? loot.Energy || 0 : 0;
}

function fillLootTable() {
  const loot = getLoot();
  if (!loot) {
    console.log('No loot data available');
    return;
  }

  rarities.forEach((rarity, rowIndex) => {
    const tr = pointsTableBody.rows[rowIndex];
    if (!tr) {
      console.log('No table row for', rarity);
      return;
    }

    const arr = loot[rarity] || [];
    for (let i=0; i<6; i++){
      const cell = tr.cells[i+1];
      if (!cell) {
        console.log('No cell at index', i+1, 'for', rarity);
        continue;
      }

      const value = arr[i] || 0;
      cell.textContent = (value*100).toFixed(2)+'%';

      if(value === 0){
        cell.style.setProperty('color', '#444', 'important');
        cell.style.setProperty('background-color', 'transparent', 'important');
      } else {
        cell.style.setProperty('color', '#fff', 'important');
        const alpha = 0.1 + 0.4 * value;
        cell.style.setProperty('background-color', `rgba(0,200,0,${alpha})`, 'important');
      }
    }
  });
}

// --- Dropdowns with animation ---
function updateDropdowns() {
  const zone = zoneSelect.value;

  const isCampaign = zone === 'campaign';
  const isDungeonOrSpider = ['dungeons','spider'].includes(zone);
  const isEventDungeon = zone === 'eventdungeon';

  const campaignDiffGroup = document.getElementById('campaign-difficulty-group');
  const campaignStageGroup = document.getElementById('campaign-stage-group');
  const dungeonDiffGroup = document.getElementById('dungeon-difficulty-group');
  const dungeonStageGroup = document.getElementById('dungeon-stage-group');

  // Animation d'apparition/disparition
  if (isCampaign) {
    campaignDiffGroup.classList.remove('hidden');
    campaignStageGroup.classList.remove('hidden');
  } else {
    campaignDiffGroup.classList.add('hidden');
    campaignStageGroup.classList.add('hidden');
  }

  if (isDungeonOrSpider) {
    dungeonDiffGroup.classList.remove('hidden');
  } else {
    dungeonDiffGroup.classList.add('hidden');
  }

  if (isDungeonOrSpider || isEventDungeon) {
    dungeonStageGroup.classList.remove('hidden');
  } else {
    dungeonStageGroup.classList.add('hidden');
  }
}

// --- Calculs ---
function updateCalculation() {
  const current = Number(currentPointsInput.value) || 0;
  const target = Number(targetPointsInput.value) || 0;
  const remaining = Math.max(target - current, 0);
  pointsRemainingSpan.textContent = remaining;

  if (remaining <= 0) {
    costSection.classList.remove('visible');
    return;
  }

  const energyPerRun = getEnergy();
  const eventType = eventTypeSelect.value;
  const zone = zoneSelect.value;
  if (!energyPerRun || !pointsData.points?.[eventType]) {
    costSection.classList.remove('visible');
    return;
  }

  let totalAvgPoints = 0;
  const pointValues = pointsData.points[eventType];
  const loot = getLoot();

  rarities.forEach(rarity => {
    const pointsForRarity = pointValues[rarity];
    const dropRates = loot[rarity] || [0,0,0,0,0,0];
    for (let i=0; i<6; i++) totalAvgPoints += (dropRates[i]||0)*(pointsForRarity[i]||0);
  });

  let uselessLoot = 0;
  if (zone === 'campaign') {
    uselessLoot = (loot["Mystery Shard"] || 0) + (loot["Champions"] || 0);
  } else {
    uselessLoot = (loot["Mystery Shard"] || 0) + (loot["Ancient Shard"] || 0) + (loot["Brews"] || 0);
  }

  const gearFactor = 1 - uselessLoot;
  totalAvgPoints *= gearFactor;

  const runsNeeded = Math.ceil(remaining / totalAvgPoints);
  const superrunsNeeded = Math.ceil(remaining / totalAvgPoints / 2);
  const totalEnergy = runsNeeded * energyPerRun;
  const gems = (totalEnergy / 3.25).toFixed(2);

  energyValue.textContent = Math.round(totalEnergy);
  gemsValue.textContent = Math.round(gems);
  runsValue.textContent = runsNeeded;
  runsHint.textContent = `or ${superrunsNeeded} super raids`;

  costSection.classList.add('visible');
}

// --- Table update ---
function updateTable() {
  const eventType = eventTypeSelect.value;
  if (!eventType) {
    generateEmptyPointsTable();
    pointsTableContainer.classList.add('hidden');
    return;
  }
  pointsTableContainer.classList.remove('hidden');
  generateEmptyPointsTable();
  if(displayMode==='points') fillPointsTable(eventType);
  else fillLootTable();
  updateCalculation();
}

// --- Toggle ---
toggleCell.addEventListener('click', () => {
  displayMode = displayMode === 'points' ? 'percent' : 'points';
  const icon = displayMode === 'points' ? 'hash' : 'bar-chart-3';
  const text = displayMode === 'points' ? 'Points' : 'Loot %';

  toggleText.textContent = text;

  const iconElement = toggleCell.querySelector('i');
  if (iconElement) {
    iconElement.setAttribute('data-lucide', icon);
    lucide.createIcons();
  }

  const eventType = eventTypeSelect.value;
  if (eventType) {
    generateEmptyPointsTable();
    if(displayMode === 'points') fillPointsTable(eventType);
    else fillLootTable();
  }
});

// --- Listeners ---
[currentPointsInput, targetPointsInput].forEach(input => input.addEventListener('input', updateCalculation));
[eventTypeSelect, zoneSelect, dungeonDifficultySelect, dungeonStageSelect, campaignDifficultySelect].forEach(el => {
  el.addEventListener('change', ()=>{updateDropdowns();updateTable();});
});
campaignStageSelect.addEventListener('change', updateTable);

function updateDungeonStages() {
  const zone = zoneSelect.value;
  const diff = dungeonDifficultySelect.value;
  let maxStages = 0;

  if (zone === 'dungeons' || zone === 'spider')
    maxStages = diff === 'normal' ? 25 : 10;
  else if (zone === 'eventdungeon')
    maxStages = 30;

  dungeonStageSelect.innerHTML = '<option value="">-- Stage --</option>';
  for (let i = 1; i <= maxStages; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `Stage ${i}`;
    dungeonStageSelect.appendChild(opt);
  }
  updateTable();
}

dungeonDifficultySelect.addEventListener('change', updateDungeonStages);
zoneSelect.addEventListener('change', () => {
  updateDropdowns();
  updateDungeonStages();
  updateTable();
});

campaignDifficultySelect.addEventListener('change', () => {
  const maxStages = 7;
  campaignStageSelect.innerHTML = '<option value="">-- Stage --</option>';
  for(let i=1;i<=maxStages;i++){
    const opt = document.createElement('option');
    opt.value=i;
    opt.textContent=`Stage ${i}`;
    campaignStageSelect.appendChild(opt);
  }
  updateTable();
});

// --- Initial setup ---
generateEmptyPointsTable();
updateDropdowns();

// Initialize Lucide icons
document.addEventListener('DOMContentLoaded', () => {
  lucide.createIcons();
});
</script>

<script src="/script.js"></script>
</body>
</html>
